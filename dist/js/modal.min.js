import{initValidateCallback as e}from"./validate.js";import{lockScroll as t,unlockScroll as o}from"./utils.js";import{API_URL as r}from"./const.js";const n=document.querySelector(".modal__close"),a=document.querySelector(".modal__overlay"),c=document.querySelectorAll(".button__slider"),s=document.querySelector(".modal__form");function i(){a.style.display="block",t(),n.addEventListener("click",l)}function l(){a.style.display="none",s.reset(),o(),n.removeEventListener("click",l)}const d=async t=>{t.preventDefault();const o=e();if(await o.revalidate())try{const e=(e=>{const t={};return e.forEach(((e,o)=>{t[o]="agreement"===o||"newsletter"===o?"on"===e||"true"===e:e})),t})(new FormData(t.target)),o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok)throw new Error("Network response was not ok");await o.json();l(),s.reset(),window.location.href="/manage"}catch(e){alert("Произошла ошибка при отправке формы. Пожалуйста, попробуйте позже.")}};export const initModal=()=>{c.forEach((e=>{e.addEventListener("click",i)})),s.addEventListener("submit",d)};